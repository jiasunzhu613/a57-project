---
title: "A57_Project"
author: "Anwar, Damaj, Zhu"
date: "2025-03-18"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```




Load Dependencies
```{r}
library(tidyverse)
library(readxl)
library(lubridate)
library(ggplot2)
library(lubridate)
library(knitr)
library(stringr)
library(tidygeocoder)
```

Load Datasets
```{r}
NOX <- read_excel("./data/NOX.xlsx", skip = 3)
O3 <- read_excel("./data/O3.xlsx", skip = 3)
PM25 <- read_excel("./data/PM25.xlsx", skip = 5)
SO2 <- read_excel("./data/SO2.xlsx", , skip = 7)
```

Fix typing
```{r, echo=FALSE}
NOX = NOX %>% mutate(Mean = as.numeric(Mean))
O3 = O3 %>% mutate(Mean = as.numeric(Mean))
PM25 = PM25 %>% mutate(Mean = as.numeric(Mean)) %>% mutate(Year = as.integer(Year))
SO2 = SO2 %>% mutate(Mean = as.numeric(Mean))
#view(PM25)
```

## NA imputing (TODO: decide what to do with this later)
```{r}
O3 = O3 %>% drop_na(Mean)
NOX = NOX %>% drop_na(Mean)
PM25 = PM25 %>% drop_na(Mean)
SO2 = SO2 %>% drop_na(Mean)
```

## Grouping similar regions
```{r}
excluded_cities = list(c("Chatham", "Sarnia"), 
                       c("St. Catharines", "Brantford", "Kitchener"), 
                       c("Hamilton Downtown", "Hamilton West"))

group_cities <- function(data, exclude_cities){
  grouped_data <- data %>%
  filter(!City %in% exclude_cities) %>%  
  # Exclude the cities from the dataset
  bind_rows(
    data %>%
      # Get only the two cities we want, group their year rows, get their means and turn them into one row
      filter(City %in% exclude_cities) %>%  
      group_by(Year) %>%
      # take mean of each column accross the row
      summarise(across(where(is.numeric), ~mean(.x, na.rm = TRUE)), .groups = "drop") %>%
      # fix the city name to be a combo of all cities
      mutate(City = paste(exclude_cities, collapse = "-"))
  )
  return(grouped_data)
}

for(excluded_city in excluded_cities){
  NOX <- group_cities(NOX, excluded_city)
  O3 <- group_cities(O3, excluded_city)
  PM25 <- group_cities(PM25, excluded_city)
  SO2 <- group_cities(SO2, excluded_city)
}
```

## Map cities
create a new data frame with city names, 
```{r}
#longlat = NOX %>% geocode(Location, method = 'osm', lat = latitude , long = longitude)
#head(longlat)
some_addresses <- tibble::tribble(
~name,                  ~addr,
"White House",          "467 University Ave. W., Windsor, Ontario",
"Transamerica Pyramid", "College Ave. & South St., Windsor",     
"Willis Tower",         "233 S Wacker Dr, Chicago, IL 60606"                                  
)
lat_longs <- some_addresses %>%
  geocode(addr, method = 'osm', lat = latitude , long = longitude)
lat_longs
```


Head of Data
```{r}
glimpse(NOX)
glimpse(PM25)
glimpse(SO2)
```


Visualizing
```{r}
#x = left_join(CO, NO2, by = join_by("Year", "City"), suffix = c(".CO", ".NO2"))
#x = left_join(x, NOX, by = year)
#x = left_join(x, PM25)
#x = left_join(x, SO2)
```


```{r}
ggplot(NOX, aes(x = Year, y = Mean, col = City)) + geom_point() + theme(legend.position="none") 
ggplot(O3, aes(x = Year, y = Mean, col = City)) + geom_point() + theme(legend.position="none") 
ggplot(PM25, aes(x = Year, y = Mean, col = City)) + geom_point() + theme(legend.position="none")
ggplot(SO2, aes(x = Year, y = Mean, col = City)) + geom_point() + theme(legend.position="none") 
```

Tables
```{r}
# Make tables
# Mean per years for that particulate matter
NOX_Yearly_Mean = NOX %>% group_by(Year) %>% summarise("Mean NOX" = mean(Mean))
# kable(NOX_Yearly_Mean)

NOX_City_mean = NOX %>% group_by(City) %>% summarise("Mean NOX" = mean(Mean))
# kable(NOX_City_mean)
```

